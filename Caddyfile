{
    cache
    metrics
}

# SSL will be served up with Fly not by Caddy
:8080 {
    cache
    log
    root * /var/www/html
    respond /status "ok"

    metrics /metrics

    # Compression
    encode zstd gzip

    # Caching: long cache for hashed assets, moderate for other static
    @hashed {
        path_regexp hashed (.*)\.(?:[0-9a-f]{8,})\.(?:css|js|svg|png|jpg|jpeg|webp|gif|woff2)
    }
    header @hashed Cache-Control "public, max-age=31536000, immutable"

    @assets {
        path *.css *.js *.svg *.png *.jpg *.jpeg *.webp *.gif *.woff2
    }
    header @assets Cache-Control "public, max-age=86400"

    file_server
}

