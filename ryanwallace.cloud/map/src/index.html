<script
  src="https://code.jquery.com/jquery-3.7.1.min.js"
  integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
  crossorigin="anonymous"
></script>
<style>
  /* Tracking stop icon button */
  .controls-section #tracking-stop-btn.tracking-stop-btn {
    /* hidden by JS until tracking starts; JS toggles to inline-block */
    display: none;
    -webkit-appearance: none;
    appearance: none;
    vertical-align: middle;
    width: auto;
    height: auto;
    line-height: normal;
    border-radius: 6px;
    border: 1px solid #ef4444; /* red-500 */
    color: #ef4444;
    background: rgba(239, 68, 68, 0.08);
    font-size: 13px;
    padding: 4px 10px;
    text-align: center;
    margin-left: 8px;
    cursor: pointer;
    box-shadow: none;
    outline: none;
    transition: background 0.15s ease, color 0.15s ease, border-color 0.15s ease, transform 0.1s ease;
    /* Nice alignment in case of flex display */
    align-items: center;
    justify-content: center;
  }
  .controls-section #tracking-stop-btn.tracking-stop-btn:hover {
    background: #ef4444;
    color: #fff;
    border-color: #ef4444;
  }
  .controls-section #tracking-stop-btn.tracking-stop-btn:active {
    transform: scale(0.95);
  }
</style>
<link
  rel="stylesheet"
  href="https://cdn.datatables.net/2.2.2/css/dataTables.dataTables.css"
/>

<div id="map" class="noselect"></div>
<div class="controls-section">
  <div class="control-group">
    <label for="refresh-rate">Refresh rate:</label>
    <select name="refresh-rate" id="refresh-rate">
      <option value="5">5 seconds</option>
      <option value="10">10 seconds</option>
      <option value="15" selected>15 seconds</option>
      <option value="30">30 seconds</option>
      <option value="60">60 seconds</option>
      <option value="99999">Off</option>
    </select>
  </div>

  <div class="control-group">
    <label>Live updates:</label>
    <span id="sse-status" class="live-badge live-polling">Polling</span>
  </div>

  <div class="control-group">
    <label>Tracking:</label>
    <span id="tracking-status" class="live-badge">Off</span>
    <button
      id="tracking-stop-btn"
      class="tracking-stop-btn"
      aria-label="Stop tracking"
      title="Stop tracking"
    >Stop</button>
  </div>

  <div class="control-group">
    <label for="follow-location">Follow location:</label>
    <label class="toggle-switch">
      <input type="checkbox" id="follow-location" name="follow-location" />
      <span class="slider"></span>
    </label>
  </div>
</div>

<script type="module" src="map.ts"></script>

<h4>Currently Operating Vehicles</h4>
<table id="vehicle-table">
  <tr>
    <td><i>Vehicle Type</i></td>
    <td class="rl"><b>RL</b></td>
    <td class="gl"><b>GL</b></td>
    <td class="bl"><b>BL</b></td>
    <td class="ol"><b>OL</b></td>
    <td class="sl"><b>SL</b></td>
    <td class="cr"><b>CR</b></td>
    <td><i>Totals</i></td>
  </tr>
  <tr>
    <td><small>Light Rail</small></td>
    <td id="rl-light" class="rl">0</td>
    <td id="gl-light" class="gl">0</td>
    <td id="bl-light">0</td>
    <td id="ol-light">0</td>
    <td id="sl-light">0</td>
    <td id="cr-light">0</td>
    <td id="light-total">0</td>
  </tr>
  <tr>
    <td><small>Heavy Rail</small></td>
    <td id="rl-heavy" class="rl">0</td>
    <td id="gl-heavy">0</td>
    <td id="bl-heavy" class="bl">0</td>
    <td id="ol-heavy" class="ol">0</td>
    <td id="sl-heavy">0</td>
    <td id="cr-heavy">0</td>
    <td id="heavy-total">0</td>
  </tr>
  <tr>
    <td><small>Regional Rail</small></td>
    <td id="rl-regional">0</td>
    <td id="gl-regional">0</td>
    <td id="bl-regional">0</td>
    <td id="ol-regional">0</td>
    <td id="sl-regional">0</td>
    <td id="cr-regional" class="cr">0</td>
    <td id="regional-total">0</td>
  </tr>
  <tr>
    <td><small>Bus</small></td>
    <td id="rl-bus">0</td>
    <td id="gl-bus">0</td>
    <td id="bl-bus">0</td>
    <td id="ol-bus">0</td>
    <td id="sl-bus" class="sl">0</td>
    <td id="cr-bus">0</td>
    <td id="bus-total">0</td>
  </tr>
  <tr>
    <td><i>Totals</i></td>
    <td id="rl-total" class="rl">0</td>
    <td id="gl-total" class="gl">0</td>
    <td id="bl-total" class="bl">0</td>
    <td id="ol-total" class="ol">0</td>
    <td id="sl-total" class="sl">0</td>
    <td id="cr-total" class="cr">0</td>
    <td id="total"><b>0</b></td>
  </tr>
</table>

<div class="info-links">
  <p>
    <a href="http://roster.transithistory.org/" target="_blank"
      >Full MBTA Vehicle Inventory</a
    >
  </p>

  <p>
    This map live updates using the
    <a href="/posts/inky-mbta-tracker-guide/" target="_blank"
      >Inky MBTA Tracker</a
    >
    <br />
    Data comes from the
    <a href="https://www.mbta.com/developers/v3-api" target="_blank"
      >MBTA V3 API</a
    >
    <br />
    Icons from
    <a href="https://labs.mapbox.com/maki-icons/" target="_blank"
      >Mapbox Maki Icons</a
    >
  </p>

  <div class="control-group" style="margin-top: 20px">
    <label for="show-elf-mode">üßù‚Äç‚ôÄÔ∏è Show Elf Scores:</label>
    <label class="toggle-switch">
      <input type="checkbox" id="show-elf-mode" name="show-elf-mode" />
      <span class="slider"></span>
    </label>
    <small style="display: block; margin-top: 5px; color: #666">
      Find queer, trans, and non-binary elves on transit! üè≥Ô∏è‚Äç‚ößÔ∏è‚ú®
    </small>
  </div>

  <div class="control-group" style="margin-top: 15px">
    <button id="elf-search-btn" class="elf-search-button">
      üîç Find Best Elf Trains
    </button>
    <div
      id="elf-search-results"
      class="elf-search-results"
      style="display: none"
    >
      <div class="elf-results-header">
        <span>üßù‚Äç‚ôÄÔ∏è Top Elf Trains</span>
        <button id="elf-search-close" class="elf-search-close">√ó</button>
      </div>
      <div id="elf-results-list" class="elf-results-list"></div>
    </div>
  </div>
</div>

<table id="alerts" class="display compact"></table>
